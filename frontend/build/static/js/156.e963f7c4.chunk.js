"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[156,1181],{8668:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(2096),i=r(221),l=r(579);const o=function(e){let{id:t,title:r,code:o,products:d,activeCategory:c,onClick:s}=e;return(0,l.jsxs)("div",{className:"category-card "+(c?"active-category":""),onClick:()=>s(t),children:[(0,l.jsx)("h1",{className:"text-black-700 text-base leading-[1.5625rem]",children:r||(0,a.t)("Nomsiz kategoriya")}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)("div",{className:"flex gap-[0.3125rem] items-center",children:[(0,l.jsxs)("p",{className:"footer-text",children:[(0,a.t)("Kodi")," :"]}),(0,l.jsx)("span",{className:"block rounded-[3.125rem] bg-warning-500 py-[0.125rem] px-[0.625rem] text-xs leading-[0.875rem] text-white-900",children:o||0})]}),(0,l.jsxs)("div",{className:"flex gap-[0.3125rem] items-center",children:[(0,l.jsxs)("p",{className:"footer-text",children:[(0,a.t)("Maxsulot turlari")," :"]}),(0,l.jsx)("span",{className:"block rounded-[3.125rem] bg-success-400 py-[0.125rem] px-[0.625rem] text-xs leading-[0.875rem] text-white-900",children:d||0})]})]}),(0,l.jsx)("div",{className:"category-card-checkmark",children:(0,l.jsx)(i.KDk,{size:"1rem",className:"check-icon"})})]})}},2662:(e,t,r)=>{r.d(t,{A:()=>l});const a=(0,r(2104).Ay)("https://moyprays.uz/"),i=JSON.parse(localStorage.getItem("userData"));a.auth={token:i.token,market:i.market};const l=a},1206:(e,t,r)=>{r.r(t),r.d(t,{default:()=>_});var a=r(5043),i=r(7630),l=r(2039),o=r(9456),d=r(827),c=r(4235),s=r(3536),n=r(8668),u=r(8054),p=r(221),m=r(9092),v=r(1466),g=r(2662),x=r(3734),h=r(5515),b=r(200),f=r(5618),y=r(3216),j=r(5345),N=r(579);const _=function(){const{t:e}=(0,m.B)(["common"]),t=(0,o.wA)(),r=(0,y.zy)(),_=(0,y.Zp)(),{currencyType:k,currency:z}=(0,o.d4)((e=>e.currency)),{connections:w,loading:S}=(0,o.d4)((e=>e.connections)),{market:C}=(0,o.d4)((e=>e.login)),{categoriesPartner:P,allProductsPartner:A}=(0,o.d4)((e=>e.registerOrders)),[$,M]=(0,a.useState)(),[E,D]=(0,a.useState)(null),[q,Y]=(0,a.useState)(P),[B,K]=(0,a.useState)([]),[O,I]=(0,a.useState)(null),[Q,T]=(0,a.useState)(""),[J,F]=(0,a.useState)([]),[G,U]=(0,a.useState)(""),[X,L]=(0,a.useState)(!1),[R,W]=(0,a.useState)(null),[Z,H]=(0,a.useState)(null),[V,ee]=(0,a.useState)(null),[te,re]=(0,a.useState)("recived"),[ae,ie]=(0,a.useState)("orderProducts"),le=e=>{O===e?I(null):(I(e),T(""),Y(P))},oe=()=>{F([]),D(null)};return(0,a.useEffect)((()=>{let e=[],r=[];C&&E&&(g.A.emit("getPartnerProducts",{market:C._id,partner:E.value}),g.A.on("partnerCategories",(e=>{let{id:r,categories:a}=e;r===C._id&&(t((0,h.B1)(a)),Y(a))})),g.A.on("setPartnerProducts",(a=>{let{id:i,products:l}=a;i===C._id&&(r=[...r,...(0,s.map)(l,(e=>({value:e._id,label:`(${e.total}) ${e.category.code}${e.productdata.code} - ${e.productdata.name}`})))],K(r),e.push(...l),t((0,h.Ql)(e)))})),g.A.on("error",(e=>{let{id:t,message:r}=e;t===C._id&&(0,x.lY)(r,"error")})))}),[C,t,E]),(0,a.useEffect)((()=>{t((0,v.cX)())}),[t]),(0,a.useEffect)((()=>{if(O){const e=(0,s.filter)(A,(e=>e.category._id===O));K((0,s.map)(e,(e=>({value:e._id,label:`(${e.total}) ${e.category.code}${e.productdata.code} - ${e.productdata.name}`}))))}else K((0,s.map)(A,(e=>({value:e._id,label:`(${e.total}) ${e.category.code}${e.productdata.code} - ${e.productdata.name}`}))))}),[O,A]),(0,a.useEffect)((()=>{const e=(0,s.map)(w,(e=>({label:(null===e||void 0===e?void 0:e.name)+" - "+(null===e||void 0===e?void 0:e.inn),value:e._id})));M(e)}),[w]),(0,a.useEffect)((()=>{const e=r.state;var t;e&&e.temporary&&(W(e),F(null===e||void 0===e?void 0:e.temporary.tableProducts),D(null===e||void 0===e||null===(t=e.temporary)||void 0===t?void 0:t.partner));if(e&&e.order){"requested"===e.position&&(re("recived"),ie("orderProducts")),"delivered"===e.position&&(re("delivered"),ie("receiveOrderProducts")),ee(e.order),D({label:e.order.sender.name+" - "+e.order.sender.inn,value:e.order.sender._id});const t=(0,s.map)(e.order.products,(e=>{var t,r,a,i,l,o,d,c,s,n,u;return{_id:e._id,sender:e.sender,product:{_id:null===(t=e.product)||void 0===t?void 0:t._id,code:null===(r=e.product)||void 0===r||null===(a=r.productdata)||void 0===a?void 0:a.code,name:null===(i=e.product)||void 0===i||null===(l=i.productdata)||void 0===l?void 0:l.name,barcode:null===(o=e.product)||void 0===o||null===(d=o.productdata)||void 0===d?void 0:d.barcode},productdata:null===(c=e.product)||void 0===c?void 0:c.productdata._id,category:null===e||void 0===e||null===(s=e.product)||void 0===s?void 0:s.category._id,totalprice:null===e||void 0===e?void 0:e.totalprice,totalpriceuzs:e.totalpriceuzs,pieces:{...null===e||void 0===e?void 0:e.pieces},total:null===e||void 0===e||null===(n=e.product)||void 0===n?void 0:n.total,unitprice:null===e||void 0===e?void 0:e.unitprice,unitpriceuzs:null===e||void 0===e?void 0:e.unitpriceuzs,unit:null===e||void 0===e||null===(u=e.product)||void 0===u?void 0:u.unit}}));F(t)}window.history.replaceState({},document.title)}),[r.state]),(0,N.jsxs)("section",{className:"flex grow relative overflow-auto",children:[(0,N.jsx)(f.A,{body:G,isOpen:X,headerText:"complete"===G?"Buyurtma uchun so'rov yuborishni tasdiqlaysizmi?":"",toggleModal:()=>{L(!1),setTimeout((()=>{U("")}),500)},approveFunction:()=>{if(J.length>0){const e={partner:E.value,products:J,orderId:V?V._id:null};t("delivered"===te?(0,h.XR)(e):V?(0,h.iY)(e):(0,h.fS)(e)).then((e=>{let{error:r,payload:a}=e;r||(V&&ee(null),H(a),setTimeout((()=>{U("checkOrder"),L(!0),oe()}),500),R&&(t((0,j.rG)({temporaryId:R._id})),W(null)))}))}else(0,x.lY)(e("Maxsulotlar ro'yxati bo'sh!"),"warning")},order:Z}),(0,N.jsxs)("div",{className:"flex flex-col grow gap-[1.25rem] overflow-auto",children:[(0,N.jsxs)("div",{className:"mainPadding flex flex gap-[1.25rem]",children:[(0,N.jsx)(i.A,{select:!0,placeholder:"",value:E||"",label:e("Do`kon nomi"),onChange:e=>D(e),options:$,border:!0,disabled:"delivered"===te}),(0,N.jsx)(i.A,{disabled:!E||"delivered"===te,select:!0,placeholder:e("misol: kompyuter"),value:"",label:e("Maxsulotlar"),onChange:t=>{if(t.barcode?(0,s.filter)(J,(e=>e.product.barcode===t.barcode)).length>0:(0,s.filter)(J,(e=>e.product._id===t.value)).length>0)(0,x.lY)(e("Maxsulot ro'yxatda mavjud !"),"error");else{const e=t.barcode?A.find((e=>e.productdata.barcode===t.barcode)):A.find((e=>e._id===t.value)),r={sender:E.value,product:{_id:e._id,code:e.productdata.code,name:e.productdata.name,barcode:e.productdata.barcode},productdata:e.productdata._id,category:e.category._id,totalprice:e.price.sellingprice,totalpriceuzs:e.price.sellingpriceuzs,pieces:{recived:1},total:e.total,unitprice:e.price.sellingprice,unitpriceuzs:e.price.sellingpriceuzs,unit:e.unit};F([...J,r])}},options:B})]}),(0,N.jsx)("div",{className:"tableContainerPadding",children:J.length?(0,N.jsx)(l.A,{page:ae,data:J,headers:{recived:[{title:"\u2116"},{title:"Maxsulot kodi"},{title:"Maxsulot nomi"},{title:"Maxsulot soni"},{title:"Maxsulot narxi"},{title:"Soni"},{title:"Jami"},{title:""}],delivered:[{title:"\u2116"},{title:"Maxsulot kodi"},{title:"Maxsulot nomi"},{title:"So'ralgan"},{title:"Yuborilgan"},{title:"Qabul qilinayotgan"},{title:"Narxi"},{title:"Jami"}]}[te],currency:k,increment:e=>{const t=(0,s.map)(J,(t=>t.product._id===e?{...t,pieces:{...t.pieces,[te]:Number(t.pieces[te])+1},totalprice:(0,b.tE)((Number(t.pieces[te])+1)*t.unitprice),totalpriceuzs:(0,b.Df)((Number(t.pieces[te])+1)*t.unitpriceuzs)}:t));F(t)},decrement:e=>{const t=(0,s.map)(J,(t=>t.product._id===e?{...t,pieces:{...t.pieces,[te]:Number(t.pieces[te])>0?Number(t.pieces[te])-1:0},totalprice:(0,b.tE)((Number(t.pieces[te])>0?Number(t.pieces[te])-1:0)*t.unitprice),totalpriceuzs:(0,b.Df)((Number(t.pieces[te])>0?Number(t.pieces[te])-1:0)*t.unitpriceuzs)}:t));F(t)},handleDelete:e=>{J.splice(e,1),F([...J])},footer:"registersale",handleCountProduct:(e,t)=>{const r=Number(e.target.value),a=(0,s.map)(J,(e=>e.product._id===t?{...e,pieces:{...e.pieces,[te]:r},totalprice:(0,b.tE)(r*e.unitprice),totalpriceuzs:(0,b.Df)(r*e.unitpriceuzs)}:e));F(a)}}):(0,N.jsx)(u.A,{text:e("Buyurtmaga mahsulotlar qo'shilmagan!...")})})]}),(0,N.jsxs)("div",{className:"register-selling-right min-w-[20.25rem] bg-white-400 backdrop-blur-[3.125rem] rounded-[0.25rem] flex flex-col gap-[1.25rem]",children:[(0,N.jsxs)("div",{className:"flex flex-col grow gap-[1.25rem]",children:[(0,N.jsx)(d.A,{placeholder:e("kategoriyani qidirish..."),value:Q,onChange:e=>{const t=e.target.value;T(t);const r=t.replace(/\s+/g," ").trim(),a=(0,s.filter)(P,(e=>e.name&&e.name.toLowerCase().includes(r)||e.code.includes(r)));Y(""!==t?a:P)},onKeyUp:()=>{}}),(0,N.jsx)("div",{className:"grow relative overflow-auto",children:(0,N.jsx)("div",{className:"cards-container absolute left-0 right-[0.125rem] top-0 bottom-0",children:S?(0,N.jsx)("div",{className:"tableContainerPadding",children:(0,N.jsx)(c.A,{})}):q.length>0?(0,s.map)(q,(e=>(0,N.jsx)(n.A,{id:e._id,activeCategory:e._id===O,title:e.name,code:e.code,products:e.products.length,onClick:le},e._id))):(0,N.jsx)(u.A,{text:e("Kategoriya mavjud emas")})})})]}),(0,N.jsxs)("div",{className:"flex gap-[0.625rem]",children:[(0,N.jsx)("button",{type:"button",className:"register-selling-right-accept-btn",onClick:()=>{J.length?(L(!0),U("complete")):z?(0,x.$5)():(0,x.QC)()},children:e("delivered"===te?"Qabul qilish":"Buyurtma berish")}),"delivered"!==te&&(0,N.jsx)("button",{type:"button",onClick:()=>{if(J.length>0){const e=J.reduce(((e,t)=>(0,b.tE)(e+t.totalprice)),0),r=J.reduce(((e,t)=>(0,b.Df)(e+t.totalpriceuzs)),0),a={temporary:{partner:E,tableProducts:J,totalPrice:e,totalPriceUzs:r}};t((0,j.K4)(a)).then((e=>{let{error:t}=e;t||(oe(),_("/dukonlar/buyurtma_berish/saqlanganlar"))})),R&&(t((0,j.rG)({temporaryId:R._id})),W(null))}else(0,x.lY)(e("Maxsulotlar ro'yxati bo'sh!"),"warning")},className:"register-selling-right-deny-btn",children:(0,N.jsx)(p.WiF,{size:"1.5rem"})})]})]})]})}}}]);
//# sourceMappingURL=156.e963f7c4.chunk.js.map